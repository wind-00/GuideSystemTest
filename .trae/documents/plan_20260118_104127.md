## 修复方案

### 1. 问题分析

用户看到的是`app_automation_map_from_script.json`文件，而这个文件是由`run-map-generator.kts`脚本生成的，不是我们修改的`map-recognizer`模块生成的。`run-map-generator.kts`脚本存在以下问题：

- **嵌套组件提取问题**：`extractComponentsFromLayout`方法没有正确处理`<layout>`根元素的XML文件，导致嵌套组件（如任务相关按钮）没有被提取
- **页面缺失问题**：虽然`findActivityFiles`方法能找到所有Activity文件，但`extractComponentsFromLayout`方法无法正确提取嵌套组件
- **布局文件匹配问题**：`findMatchingLayoutFile`方法只尝试查找`activity_xxx.xml`，没有考虑其他可能的匹配方式
- **返回按钮识别问题**：`extractTargetFromClick`方法没有识别`finish()`方法作为返回操作

### 2. 修复方案

我需要修改`run-map-generator.kts`脚本，使其与我们修改的`map-recognizer`模块功能保持一致，特别是在处理嵌套组件和布局文件匹配方面。

### 3. 修复步骤

1. **修改`extractComponentsFromLayout`方法**：添加递归提取逻辑，能正确处理`<layout>`根元素的XML文件，提取所有嵌套组件
2. **修改`findMatchingLayoutFile`方法**：优化布局文件匹配逻辑，确保能正确匹配到所有布局文件
3. **修改`extractTargetFromClick`方法**：识别`finish()`方法作为返回操作
4. **修改`buildIntentModel`方法**：优化目标状态ID的匹配逻辑，确保能正确识别所有导航情况
5. **测试修复效果**：运行脚本，验证生成的地图包含所有页面和组件

### 4. 预期结果

- 生成的`app_automation_map_from_script.json`文件包含所有6个页面（Main、Second、Second2、Third、Third2、Third3）
- 每个页面包含所有组件，包括嵌套组件（如任务相关按钮）
- 地图符合严格的语义规则：Map = UI World Model, Intent = behavior+result carrier, State = observable facts only
- 地图是确定性、可验证和可重用的，具有清晰的状态转移

### 5. 修复的文件

- `run-map-generator.kts`：修复嵌套组件提取问题、布局文件匹配问题、返回按钮识别问题等

### 6. 测试方法

1. 运行脚本：`kotlinc -script run-map-generator.kts`
2. 检查生成的地图文件：`app_automation_map_from_script.json`
3. 验证地图包含所有6个页面和所有组件
4. 验证地图符合严格的语义规则

修复后的脚本将生成完整的应用自动化地图，包含所有页面和组件，符合所有要求。