# 修复悬浮窗和页面显示问题

## 问题分析

### 1. 悬浮窗显示当前页面：未知
- **原因**：`ActivityPageStateProvider` 中的 `currentActivityRef` 可能为 null，导致 `getCurrentPageId()` 返回 null
- **检查结果**：`ActivityPageStateProvider` 注册了 `Application.ActivityLifecycleCallbacks`，但可能没有正确捕获当前活动的 Activity

### 2. 输入框无法输入字符
- **原因**：`WindowManager.LayoutParams` 中设置了 `FLAG_NOT_FOCUSABLE` 标志，这会导致悬浮窗无法获取焦点，从而无法输入文本
- **检查结果**：在 `OverlayView.kt` 第 119 行，确实设置了 `FLAG_NOT_FOCUSABLE` 标志

### 3. 第二层级1页面显示存在问题，和之前不一样了，而且是英文
- **原因**：`SecondActivity.kt` 文件不存在，但 `MainActivity.kt` 中仍然引用了它
- **检查结果**：`MainActivity.kt` 第 181 行引用了 `SecondActivity::class.java`，但该文件不存在

## 修复计划

### 1. 修复悬浮窗无法获取当前页面ID的问题
- 检查 `ActivityPageStateProvider` 的实现，确保它能正确捕获当前活动的 Activity
- 可能需要在 `MainActivity` 初始化时确保 `ActivityPageStateProvider` 正确注册

### 2. 修复输入框无法输入字符的问题
- 修改 `OverlayView.kt` 中的 `WindowManager.LayoutParams` 标志
- 移除 `FLAG_NOT_FOCUSABLE` 标志，或者添加 `FLAG_WATCH_OUTSIDE_TOUCH` 来实现点击外部区域时的行为

### 3. 修复第二层级1页面显示问题
- 创建缺失的 `SecondActivity.kt` 文件，确保其内容与之前一致
- 或者修改 `MainActivity.kt` 中的引用，指向现有的 `SecondActivity2.kt`

### 4. 验证修复效果
- 运行应用，检查悬浮窗是否能正确显示当前页面
- 测试输入框是否能正常输入字符
- 验证第二层级1页面是否能正常显示，且为中文

## 预期结果

- 悬浮窗能正确显示当前页面的名称
- 输入框能正常输入字符
- 第二层级1页面能正常显示，且为中文
- 应用能正常运行，无崩溃或异常