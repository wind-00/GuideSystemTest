# 修复地图映射问题的普适性方案

## 问题分析

通过分析地图生成程序和应用代码，我发现以下问题：

1. **地图生成流程**：
   * `map`目录下的程序生成`ui_map.json`文件
   * `enhance_fsm_transition.py`程序增强`fsm_transition.json`，添加`action_metadata`和`visible_text_index`字段
   * `fsm_transition.json`包含完整的`action_index`映射（actionId到componentId的对应关系）

2. **应用代码问题**：
   * `PlannerClientImpl.kt`使用硬编码的actionId到componentId映射
   * 当`fsm_transition.json`中的映射发生变化时，硬编码映射不会自动更新
   * 导致某些actionId（如0）无法找到对应的componentId，执行失败

3. **根本原因**：
   * 应用代码没有从`fsm_transition.json`动态读取映射关系
   * 而是使用了静态的硬编码映射，与实际生成的JSON文件不同步

## 解决方案

修改`PlannerClientImpl.kt`文件，使其能够：

1. **动态读取映射**：
   * 从fsm_transition.json文件的action_metadata部分读取actionId到componentId的映射
   * 构建映射缓存，提高访问速度
   * 当fsm_transition.json中的映射发生变化时，自动读取最新的映射

2. **容错处理**：
   * 当文件不存在或解析失败时，使用默认映射作为后备
   * 添加详细的日志输出，便于调试

3. **普适性设计**：
   * 不针对特定组件做特殊处理
   * 适用于所有actionId和componentId的映射
   * 自动适应地图生成程序的输出变化

## 具体修改步骤

1. **修改PlannerClientImpl.kt**：
   * 添加JSON文件读取逻辑，使用JSONObject解析fsm_transition.json
   * 构建actionId到componentId的动态映射表
   * 替换硬编码的when语句，使用动态映射
   * 添加详细的容错处理和日志输出

2. **测试验证**：
   * 运行应用测试从不同页面的导航
   * 验证所有actionId都能正确映射到componentId
   * 确保执行流程正常完成

## 预期效果

修改后，应用将能够：
* 动态从fsm_transition.json读取最新的映射关系
* 自动适应地图生成程序的输出变化
* 避免因硬编码映射导致的执行失败
* 确保从任何页面发起的导航都能正常执行
* 无需对特定组件做特殊处理，适用于所有可触发组件

